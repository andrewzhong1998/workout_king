<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Home</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Questrial&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom_style.css" />
    <link rel="stylesheet" href="css/kanban.css" />
    <link rel="stylesheet" href="/node_modules/bulma/css/bulma.css" />
    <script async type="text/javascript" src="/js/bulma.js"></script>
    <script type="text/javascript" src="/js/diet.js"></script>
    <script type="text/javascript" src="/js/user.js"></script>
    <script type="text/javascript" src="/node_modules/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="/node_modules/axios/dist/axios.js"></script>
</head>

<body>
<script>
    let user = null
    getInfo().then(res=>{
        user=res.data
        if(user!='') $('#log_in').removeClass('is-hidden')
        else  $('#not_log_in').removeClass('is-hidden')
    }).catch(err=>{console.log(err)})
    String.prototype.replaceAll = function(search, replacement) {
        let target = this;
        return target.split(search).join(replacement);
    };
    let switchToOverview = () => {
        $('#tabNutrition').removeClass('is-active')
        $('#tabOverview').addClass('is-active')
        $('#tableNutritions').addClass('is-hidden')
        $('#tableOverview').removeClass('is-hidden')
    }
    let switchToNutrition = () => {
        $('#tabNutrition').addClass('is-active')
        $('#tabOverview').removeClass('is-active')
        $('#tableNutritions').removeClass('is-hidden')
        $('#tableOverview').addClass('is-hidden')
    }
    let foodRecords = []
    let foodRecords_json = []
    let nutritions = null
    let addRecord = () => {
        let amount = $('#inputAmmount').val()
        let unit = $('#selectUnit').val()
        let food = $('#inputFood').val()
        if(amount.length==0||food.length==0||unit.length==0) return;
        if(isNaN(amount)){
            alert("Amount should be a number")
            return;
        }
        $('#inputAmmount').val('')
        $('#selectUnit').val('Piece')
        $('#inputFood').val('')
        $('#summaryFoods').append(`<a class="list-item">${food} (${amount} ${unit})</a>`)
        foodRecords.push(`${amount} ${unit} ${food}`)
        foodRecords_json.push({
            food: food,
            amount: amount,
            unit: unit
        })
        if(foodRecords.length==0) $('#summary').addClass('is-hidden');
        else $('#summary').removeClass('is-hidden');
    }
    let calculate = ()=>{
        if(foodRecords.length==0) return;
        $('#buttonCalculate').addClass("is-loading");
        getCalories(foodRecords).then((res)=>{
            $('#buttonCalculate').removeClass("is-loading");
            nutritions = res.data
            let nutritionFacts = renderReport(nutritions)
            console.log(nutritions)
        }).catch((err)=>{
            $('#buttonCalculate').removeClass("is-loading");
            alert("Oops, the third-party API returned error message. Check console for the details.")
            console.log(err)
        })
    }
    let record = () => {
        if(nutritions==null){
            alert("Nothing to record")
            return;
        }
        let description = $('#inputDescription').val()
        if(description.length==0) description = "Untitled Meal"
        let calories = 0
        if(nutritions['calories']!=null) calories = nutritions['calories']
        let fat = 0
        if(nutritions.totalNutrients['FAT']!=null) fat = nutritions.totalNutrients['FAT']['quantity']
        let carbohydrate = 0
        if(nutritions.totalNutrients['CHOCDF']!=null) carbohydrate = nutritions.totalNutrients['CHOCDF']['quantity']
        let protein = 0
        if(nutritions.totalNutrients['PROCNT']!=null) protein = nutritions.totalNutrients['PROCNT']['quantity']
        if(user==null||user=='') location.href="login.html"
        addRecordToDatabase(description,calories,fat,carbohydrate,protein,foodRecords_json).then((res)=>{
            if(res.data==true) location.href="user_dashboard.html"
            else alert("Record failed")
        }).catch((err)=>{console.log(err)})
    }
    let renderReport = (data) => {
        $('#divReport').removeClass('is-hidden')
        $('#intakeLabels').html('')
        $('#healthLabels').html('')
        $('#cautionLabels').html('')
        $('#dietLabels').html('')
        $('#listNutritions').html('')
        let keys = Object.keys(data.totalDaily);
        for(let i=0;i<keys.length;i++){
            if(data.totalNutrients[keys[i]]!=null){
                let name = data.totalDaily[keys[i]].label
                let amount = data.totalNutrients[keys[i]].quantity + data.totalNutrients[keys[i]].unit
                let percentage = data.totalDaily[keys[i]].quantity + data.totalDaily[keys[i]].unit
                $('#listNutritions').append(`<tr><td>${name}</td><td>${amount}</td><td>${percentage}</td></tr>`)
                //console.log([name,amount,percentage])
            }
        }
        let cautionLabels = data.cautions
        let dietLabels = data.dietLabels
        let healthLabels = data.healthLabels
        let calories = data.calories
        let totalWeight = data.totalWeight

        $('#intakeLabels').append(`
                            <div class="board-item">
                                <div class="board-item-content"><span>Calories: ${calories}kJ</span></div>
                            </div>
                            <div class="board-item">
                                <div class="board-item-content"><span>Total Weight: ${totalWeight}g</span></div>
                            </div>`)

        if(healthLabels!=null&&healthLabels.length>0){
            for(let i=0;i<healthLabels.length;i++) $('#healthLabels').append(`
                            <div class="board-item">
                                <div class="board-item-content"><span>${healthLabels[i].toLowerCase().replaceAll('_',' ')}</span></div>
                            </div>`)
        }else{
            $('#healthLabels').append(`<div class="board-item">
                                <div class="board-item-content"><span>No labels matched</span></div>
                            </div>`)
        }
        if(cautionLabels!=null&&cautionLabels.length>0){
            for(let i=0;i<cautionLabels.length;i++) $('#cautionLabels').append(`
                            <div class="board-item">
                                <div class="board-item-content"><span>${cautionLabels[i].toLowerCase().replaceAll('_',' ')}</span></div>
                            </div>`)
        }else{
            $('#cautionLabels').append(`<div class="board-item">
                                <div class="board-item-content"><span>No labels matched</span></div>
                            </div>`)
        }
        if(dietLabels!=null&&dietLabels.length>0){
            for(let i=0;i<dietLabels.length;i++) $('#dietLabels').append(`
                            <div class="board-item">
                                <div class="board-item-content"><span>${dietLabels[i].toLowerCase().replaceAll('_',' ')}</span></div>
                            </div>`)
        }else{
            $('#dietLabels').append(`<div class="board-item">
                                <div class="board-item-content"><span>No labels matched</span></div>
                            </div>`)
        }
    }
</script>
<nav class="navbar is-white">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item brand-text" href="/">
                Workout Ninja
            </a>
            <div class="navbar-burger burger" data-target="navMenu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="navMenu" class="navbar-menu">
            <div class="navbar-start">
                <!--
                <a class="navbar-item" href="user_dashboard.html">
                    Home
                </a>
                <a class="navbar-item" href="diet.html">
                    Diet
                </a>
                -->
            </div>
        </div>
        <div class="navbar-end">
            <div class="navbar-item">
                <div class="field is-grouped is-hidden" id="not_log_in">
                    <p class="control">
                        <a class="button" href="login.html">
                            Login
                        </a>
                    </p>
                    <p class="control">
                        <a class="button is-primary" href="signup.html">
                            Sign Up
                        </a>
                    </p>
                </div>
                <div class="field is-grouped is-hidden" id="log_in">
                    <p class="control">
                        <a class="button is-link" href="user_dashboard.html">
                            Dashboard
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</nav>

<section class="hero is-primary is-medium has-text-centered" id="bannerTitle">
    <div class="hero-body">
        <div class="container" id="titleText">
            <h1 class="title bannerTitleText">
                Calorie Calculator!!!
            </h1>
            <h2 class="subtitle bannerTitleText">
                Choose Your Food Items Below!!!
            </h2>
        </div>
    </div>
</section>

<section class="section" id="appDescription">
    <div class="container">
        <div class="content">
            <h1 class="title">Why Use Calorie Calculator</h1>
            <div class=>
                <blockquote>
                    <div class="blockTextClass">
                        <p id="blockText">
                            "I used Calorie Calculator, and I have lost over 30 pounds!!"
                        </p>
                    </div>
                </blockquote>
                <p>
                    We know that it can be hard to eat healthy and maintain a good lifestyle.
                    Well, Calorie Calculator makes that easy since we can keep track of everything
                    that you eat and tell you exactly what you are putting into your body.
                </p>
            </div>
        </div>
    </div>
</section>

<section class="section" id="calculator">
    <div class="columns">
        <div class="column">
            <div class="column">
                <div class="field has-addons has-addons-centered">
                    <p class="control">
                        <input class="input" type="text" placeholder="Enter the amount" id="inputAmmount">
                    </p>
                    <p class="control">
                        <span class="select">
                            <select id="selectUnit">
                                <option value="Piece" class="is-selected">Piece</option>
                                <option value="Cup">Cup</option>
                                <option value="Bowl">Bowl</option>
                                <option value="Kilogram">Kilogram</option>
                                <option value="Gram">Gram</option>
                                <option value="Liter">Liter</option>
                                <option value="Bottle">Bottle</option>
                                <option value="Serving">Serving</option>
                                <option value="Ounce">Ounce</option>
                            </select>
                        </span>
                    </p>
                    <p class="control">
                        <a class="button is-static">
                            of
                        </a>
                    </p>
                    <p class="control">
                        <input class="input" type="text" id="inputFood" placeholder="Enter the food name">
                    </p>
                    <p class="control">
                        <a class="button is-primary" onclick="addRecord();">
                            Add
                        </a>
                    </p>
                </div>
            </div>
            <div class="column is-hidden" id="summary">
                <div class="list is-hoverable" id="summaryFoods"></div>
                <div class="field is-grouped">
                    <div class="control">
                        <button class="button" id="buttonCalculate" onclick="calculate();">Analyze</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="column is-hidden" id="divReport">
            <div class="tabs is-boxed">
                <ul>
                    <li id="tabOverview" class="is-active" onclick="switchToOverview()">
                        <a>
                            <span>Overview</span>
                        </a>
                    </li>
                    <li id="tabNutrition" onclick="switchToNutrition()">
                        <a>
                            <span>Nutrition</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="container">
                <table class="table is-hidden" id="tableNutritions">
                    <thead>
                    <tr>
                        <th>Nutrition</th>
                        <th>Amount</th>
                        <th>Daily %</th>
                    </tr>
                    </thead>
                    <tbody id="listNutritions"></tbody>
                </table>
                <div id="tableOverview">
                    <article class="message is-info">
                        <div class="message-header">
                            <p>Intake</p>
                        </div>
                        <div class="message-body" id="intakeLabels">
                        </div>
                    </article>
                    <article class="message is-primary">
                        <div class="message-header">
                            <p>Health Labels</p>
                        </div>
                        <div class="message-body" id="healthLabels">
                        </div>
                    </article>
                    <article class="message is-link">
                        <div class="message-header">
                            <p>Diet Labels</p>
                        </div>
                        <div class="message-body" id="dietLabels">
                        </div>
                    </article>
                    <article class="message is-warning">
                        <div class="message-header">
                            <p>Cautions</p>
                        </div>
                        <div class="message-body" id="cautionLabels">
                        </div>
                    </article>
                </div>
            </div>
            <p class="content">
                <div class="field has-addons has-addons-centered">
                    <div class="control">
                        <input type="text" id="inputDescription" placeholder="Description (e.g. Lunch)">
                    </div>
                    <div class="control">
                        <button id="buttonRecord" class="button" onclick="record()">Record</button>
                    </div>
                </div>
                <a>*To relieve the stress of our database storage, we only record calories, protein, fat, and carbohydrate for the time being.</a>
            </p>
        </div>
    </div>
</section>
<section class="section" id="pictures">
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/apple.jpg" alt="Apple" />
            <div class="img__description_layer">
                <p class="img__description">This is an apple.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/banana.png" alt="Banana" />
            <div class="img__description_layer">
                <p class="img__description">This is a banana.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/chicken.png" alt="Chicken" />
            <div class="img__description_layer">
                <p class="img__description">This is a chicken.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/corn.jpg" alt="Corn" />
            <div class="img__description_layer">
                <p class="img__description">This is a corn.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/egg.jpg" alt="Egg" />
            <div class="img__description_layer">
                <p class="img__description">This is an egg.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/grape.svg" alt="Grape" />
            <div class="img__description_layer">
                <p class="img__description">This is a grape.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/lettuce.png" alt="Lettuce" />
            <div class="img__description_layer">
                <p class="img__description">This is a slice of lettuce.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/nuts.png" alt="Nuts" />
            <div class="img__description_layer">
                <p class="img__description">These are mixed nuts.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/orange.png" alt="Orange" />
            <div class="img__description_layer">
                <p class="img__description">This is an orange.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/potatoes.jpg" alt="Potatoes" />
            <div class="img__description_layer">
                <p class="img__description">These are potatoes.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/rice.png" alt="Rice" />
            <div class="img__description_layer">
                <p class="img__description">This is a bowl of rice.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/salmon.png" alt="Salmon" />
            <div class="img__description_layer">
                <p class="img__description">This is a salmon.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/shrimp.png" alt="Shrimp" />
            <div class="img__description_layer">
                <p class="img__description">This is a shrimp.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/steak.png" alt="Steak" />
            <div class="img__description_layer">
                <p class="img__description">This is a steak.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/sushi.png" alt="Sushi" />
            <div class="img__description_layer">
                <p class="img__description">These are sushi.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/yogurt.png" alt="Yogur" />
            <div class="img__description_layer">
                <p class="img__description">This is a cup of yogurt.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/avocado.svg" alt="Avocado" />
            <div class="img__description_layer">
                <p class="img__description">This is an avocado.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/broccoli.png" alt="Broccoli" />
            <div class="img__description_layer">
                <p class="img__description">This is a broccoli.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/carrot.png" alt="Carrot" />
            <div class="img__description_layer">
                <p class="img__description">This is a carrot.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/cucumber.png" alt="Cucumber" />
            <div class="img__description_layer">
                <p class="img__description">This is a cucumber.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/pizza.png" alt="Pizza" />
            <div class="img__description_layer">
                <p class="img__description">This is a slice of pizza.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/hamburger.png" alt="hamburger" />
            <div class="img__description_layer">
                <p class="img__description">This is a hamburger.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/burrito.svg" alt="Burrito" />
            <div class="img__description_layer">
                <p class="img__description">This is a burrito.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/fries.png" alt="Fries" />
            <div class="img__description_layer">
                <p class="img__description">There are fries.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/cookie.png" alt="Cookie" />
            <div class="img__description_layer">
                <p class="img__description">This is a cookie.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/ramen.png" alt="Ramen" />
            <div class="img__description_layer">
                <p class="img__description">This is a bowl of ramen.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/coke.png" alt="Coke" />
            <div class="img__description_layer">
                <p class="img__description">This is a bottle of coke.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/sandwich.png" alt="Sandwich" />
            <div class="img__description_layer">
                <p class="img__description">This is a sandwich.</p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="img__wrap column is-food">
            <img class="food" src="image/pasta.png" alt="Pasta" />
            <div class="img__description_layer">
                <p class="img__description">This is a plate of pasta.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/milk.png" alt="Milk" />
            <div class="img__description_layer">
                <p class="img__description">This is a bottle of milk.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/chocolate.png" alt="Chocolate" />
            <div class="img__description_layer">
                <p class="img__description">This is a bar of chocolate.</p>
            </div>
        </div>
        <div class="img__wrap column is-food">
            <img class="food" src="image/coffee.jpg" alt="Coffee" />
            <div class="img__description_layer">
                <p class="img__description">This is a cup of coffee.</p>
            </div>
        </div>
    </div>
</section>
</body>
<script>
</script>

</html>